# 铁路极端天气通知生成器

一个基于React + Dify的智能铁路运输极端天气应对通知生成系统。系统能够根据用户输入的天气类型、时间、线路等信息，自动生成符合铁路行业标准的正式通知文档。

## 功能特性

- 🚄 **专业铁路通知生成**：基于铁路行业标准格式生成正式通知
- 🤖 **AI智能分析**：使用Dify平台进行智能内容生成
- 🧠 **思考过程可视化**：AI思考过程单独显示，可折叠查看
- 📝 **Markdown格式渲染**：支持加粗、斜体、标题等格式正确显示
- 🎨 **标准公文格式**：第一行"通知"红色居中显示，标题居中加粗
- ⚡ **流式输出**：实时显示AI生成过程
- 📱 **响应式设计**：适配不同屏幕尺寸

## 技术栈

- **前端**: React 18 + Vite
- **UI组件**: Material-UI (MUI)
- **AI平台**: Dify
- **样式**: CSS-in-JS

## 安装部署

### 1. 克隆项目
```bash
git clone <项目地址>
cd weather
```

### 2. 安装依赖
```bash
npm install
```

### 3. 启动开发服务器
```bash
npm run dev
```

访问 `http://localhost:5173` (或显示的端口)

## Dify配置

### 1. Dify API设置

在 `src/App.jsx` 中修改以下配置：

```javascript
// 修改API地址
const response = await fetch('http://localhost/v1/chat-messages', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',  // 替换为你的API密钥
    'Content-Type': 'application/json'
  },
  // ...
});
```

### 2. 获取Dify API密钥

1. 登录你的Dify平台
2. 进入应用管理页面
3. 选择或创建一个应用
4. 在"API访问"页面找到API密钥
5. 复制API密钥并替换代码中的`YOUR_API_KEY`

### 3. Dify应用配置

推荐使用以下提示词模板：

```
你是铁路车务调度部门的通知起草专家，负责撰写应对极端天气（如强降雨、寒潮、暴雪、台风、高温等）下的铁路运输组织通知。

<think>
用户提供了以下信息：
- 发文单位：{{unit}}
- 天气类型：{{weather}}  
- 起始日期：{{start_date}}
- 结束日期：{{end_date}}
- 涉及线路：{{lines}}
- 附件信息：{{attachment}}


现在分析这个天气类型对铁路运输可能造的影响：
1. 分析天气特点和危险性
2. 评估对指定线路的潜在影响
3. 制定针对性的应对措施
4. 确保措施覆盖各个关键环节


基于这些信息，我需要撰写一份专业、全面、可操作的铁路运输应对通知。
</think>


请严格按照用户提供的参数信息，撰写一份正式、结构完整、符合铁路行业标准，可直接用于纸面发布的通知，必须满足以下格式要求：
顶部第一行为“通知”二字

**通知要求：**


**通知标题**
格式：[发文单位]关于积极做好[天气类型]应对工作的通知


**正文开头**  
简要说明天气预报情况、涉及线路、可能影响及工作要求。


通知正文结构：
开头称呼：“机关各科室、段属各站所：”
紧接着简要说明气象预报、影响线路、气象威胁、以及必须采取的措施总要求
紧接着列出应对措施


应对措施条目要求：
统一使用阿拉伯数字编号：1. 2. 3. 形式
每条应包含简洁明了的标题（加粗）+ 正式表述的执行内容
禁止使用“一、二”或“第一、第二”等章节式编号
每条内容不使用分隔线（不要输出“---”）
措施应涵盖：值班值守、设备检查、调车安全、旅客服务、应急物资、舆情应对等铁路运输安全核心要素
最少5段，最多7段，需要覆盖不同的角度每一段需要最少100字，至多350字




结尾落款格式：
{{unit}}
{{end_date}}

单位和日期各占一行，放在正文结尾，不加额外说明



如果填写了附件信息（即 {{attachment}} 非空），在正文结尾之后添加一行：
附件：{{attachment}}

**格式要求：**
- 使用**粗体**突出重要标题和关键词
- 保持专业的文件格式和用词
- 确保内容逻辑清晰、结构完整
- 避免使用【】等特殊符号标记
- 全文总字数必须超过1000字

请严格按照以上要求输出，确保通知内容专业、实用、符合铁路行业标准。
```
同时在dify的变量中配置：
变量 Key|字段名称
unit|unit|
weather|weather|
start_date|start_date|
end_date|end_date|
lines|lines|
attachment|attachment|

## 使用方法

### 1. 填写表单信息
- **发文单位**：如"赣州车务段"
- **天气类型**：如"低温天气"、"强降雨"、"暴雪"等
- **起始日期**：天气影响开始时间
- **结束日期**：天气影响结束时间  
- **涉及线路**：如"京九线、赣龙线、兴泉线"
- **附件信息**：相关附件标题（可选）

### 2. 生成通知
点击"生成通知"按钮，系统将：
1. 向Dify API发送请求
2. 实时显示生成过程
3. 分离AI思考过程和主要内容
4. 格式化显示最终通知

### 3. 查看结果
- **思考过程**：点击可折叠区域查看AI分析过程
- **生成结果**：符合铁路行业标准的正式通知文档

## 项目结构

```
weather/
├── public/
│   └── vite.svg
├── src/
│   ├── App.jsx          # 主应用组件
│   ├── App.css          # 应用样式
│   ├── main.jsx         # 应用入口
│   ├── index.css        # 全局样式
│   └── assets/
│       └── react.svg
├── package.json         # 项目依赖
├── vite.config.js       # Vite配置
├── README.md           # 项目说明
└── 提示词.md    # Dify提示词模板
```

## 核心功能说明

### Think内容分离
系统自动识别AI输出中的`<think>`标签，将思考过程单独显示在可折叠区域。

### Markdown渲染
支持以下格式：
- `**加粗文本**` → **加粗文本**
- `*斜体文本*` → *斜体文本*
- `# 标题` → 标题
- `1. 编号列表` → 编号列表

### 特殊格式化
- 第一行"通知"：红色、居中、加粗、大字号、下划线
- 通知标题：居中、加粗显示

## 环境要求

- Node.js 16+
- npm 或 yarn
- 现代浏览器支持

## 开发命令

```bash
# 开发环境启动
npm run dev

# 构建生产版本
npm run build

# 预览构建结果
npm run preview

# 代码检查
npm run lint
```

## 注意事项

1. **API地址配置**：确保Dify API地址正确，可以是本地部署或云端服务
2. **CORS设置**：如果遇到跨域问题，需要在Dify服务端配置CORS
3. **API密钥安全**：生产环境中不要将API密钥硬编码，建议使用环境变量
4. **网络连接**：确保前端能够正常访问Dify API服务

## 故障排除

### 常见问题

**1. API调用失败**
- 检查Dify服务是否正常运行
- 验证API密钥是否正确
- 确认网络连接是否正常

**2. 思考内容不显示**
- 确保Dify提示词中包含`<think>`标签
- 检查AI输出格式是否正确

**3. 格式显示异常**
- 确认markdown语法是否正确
- 检查浏览器控制台是否有错误信息
